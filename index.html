<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0b3d91">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ECLC">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/eclc-logo192-test.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/eclc-logo512-test.png">
  <title>ECLC Connect and Support</title>
  <style>
    :root {
      --light-aqua: #E7FCFB;
      --mint-green: #2FDBB8;
      --teal: #15B2AE;
      --text-dark: #002B56;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, var(--light-aqua), var(--mint-green), var(--teal));
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 16px;
      background: transparent;
      flex-shrink: 0;
    }
    .header-left {
      flex: 1;
      text-align: right;
      font-size: 16px;
      font-weight: bold;
      padding-right: 10px;
    }
    .header-right {
      flex: 1;
      text-align: left;
      font-size: 16px;
      font-weight: bold;
      padding-left: 10px;
    }
    .logo {
      width: 120px;
      height: auto;
    }
    main {
      flex: 1;
      text-align: center;
      padding: 20px;
    }
    .button {
      background-color: var(--mint-green);
      color: white;
      padding: 14px 28px;
      margin: 12px 12px 32px;
      border: none;
      border-radius: 10px;
      font-size: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background-color 0.3s;
      max-width: 300px;
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .button:hover {
      background-color: var(--teal);
    }
    .button:focus {
      outline: 3px solid var(--text-dark);
      outline-offset: 2px;
    }
    .link-button {
      display: block;
      width: fit-content;
      margin: 16px auto;
      background: none;
      border: none;
      padding: 0;
      color: var(--text-dark);
      font-size: 18px;
      cursor: pointer;
      text-decoration: none;
    }
    .link-button:hover {
      text-decoration: underline;
    }
    .page { display: none; }
    .page.active { display: block; }
    .back-button {
      margin-top: 20px;
      font-size: 16px;
      color: var(--text-dark);
      cursor: pointer;
    }
    footer {
      flex-shrink: 0;
      padding: 12px;
      text-align: center;
      font-size: 16px;
      background: transparent;
    }
    form {
      max-width: 360px;
      margin: auto;
      text-align: left;
    }
    form label {
      font-weight: bold;
      font-size: 16px;
    }
    #report-form label {
      display: grid;
	  grid-template-columns: auto 1fr;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    form input, form select, form textarea {
      width: 100%;
      padding: 8px;
      margin: 4px 0 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #impact-range {
      margin-bottom: 16px;
      font-size: 16px;
    }
    ul.resources {
      list-style: none;
      padding: 0;
      text-align: left;
      max-width: 360px;
      margin: auto;
    }
    ul.resources li a {
      display: block;
      font-size: 16px;
      margin: 8px 0;
      color: var(--text-dark);
      text-decoration: none;
    }
    ul.resources li a:hover {
      text-decoration: underline;
    }
.checkbox-label {
  display: inline-flex;
  align-items: center;
  justify-content: flex-start; 
  margin: 0 24px 12px 0;
  font-weight: bold;
  font-size: 16px; 
}

.checkbox-label input[type="checkbox"] {
  margin-left: 8px;
}
form button.button {
	display: block;
	margin: 24px auto;
}
#devotional-verse {
  font-weight: bold;
  font-style: italic;
  margin-bottom: 1em;
}
#devotional-text p:last-child {
  font-weight: bold;
  margin-top: 1em;
}
#dev-date {
  font-weight: bold;
  font-size: 1.25rem;
  margin: 0.5em 0;
}
textarea{
  vertical-align: top;
  padding-top: 8px;
  line-height: 1.4;
}
.map-container {
  max-width: 360px;
  margin: 0 auto 16px;
}
#contact-page p a {
  color: var(--text-dark);
  text-decoration: none;
  font-weight: bold;
}
#contact-page p a:hover {
  text-decoration: underline;
}
#install-btn {
  display: none;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
}
@media (max-width: 360px) {
  .button {
    padding: 12px 24px;
    font-size: 18px;
  }
}
@media (min-width: 768px) {
  #install-btn {
    display: none !important;
  }
}
#picked-up-page main form {
  display: flex;
  flex-direction: column;
  align-items: center;
}
#picked-up-page main form input[type="text"],
#picked-up-page main form select {
  width: auto;
  max-width: 240px;
  margin: 8px 0 24px;
}
#report-use-page main form {
  display: flex;
  flex-direction: column;
  align-items: center;
}
#report-use-page main form input[type="text"],
#report-use-page main form select {
  width: auto;
  max-width: 240px;
  margin: 8px 0 24px;
}
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left" style="cursor:pointer" onClick="showPage('home-page')">Support. Educate.</div>
    <img 
      src="eclc-logo.png" 
      alt="ECLC Logo" 
      class="logo"
      id="site-logo"
      style="cursor:pointer;"
      onClick="showPage('home-page')"
      />
    <div class="header-right" style="cursor:pointer" onClick="showPage('home-page')">Advocate. Resilience.</div>
  </div>
  <main>
    <div id="home-page" class="page active">
      <button class="button" onclick="showPage('picked-up-page')">I Picked Up Narcan</button>
      <button class="button" onclick="showPage('report-use-page')">Report Narcan Use</button>
      <button class="link-button" onclick="showPage('contact-page')">Contact ECLC</button>
      <button class="link-button" onclick="showPage('resources-page')">Community Resources</button>
      <button class="link-button" onclick="showPage('impact-page')">Community Impact</button>
      <button class="link-button" onclick="showPage('devotional-page')">Recovery Devotional</button>
      <button class="button" id="install-btn" style="display:none">Connect and Support with the ECLC App!</button>
    </div>
    <div id="picked-up-page" class="page">
      <h2>I Picked Up Narcan</h2>
      <form id="pickup-form">
        <input type="hidden" name="formType" value="pickup">
        <label>How many boxes picked up?</label>
        <input type="number" name="boxes" min="1" required>
        <label>Age (Optional)</label>
        <select name="age">
          <option value="" disabled selected hidden>Select your age</option>
          <option value="Under 18">Under 18</option>
          <option value="18-24">18-24</option>
          <option value="25-34">25-34</option>
          <option value="35-44">35-44</option>
          <option value="45-54">45-54</option>
          <option value="55-64">55-64</option>
          <option value="65+">65+</option>
        </select>
        <label>Sex (Optional)</label>
        <select name="sex">
          <option value="" disabled selected hidden>Select your sex</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <label>Ethnicity (Optional)</label>
        <select name="ethnicity">
          <option value="" disabled selected hidden>Select your ethnicity</option>
          <option value="White">White</option>
          <option value="Black or African American">Black or African American</option>
          <option value="Hispanic or Latino">Hispanic or Latino</option>
          <option value="Native American or Alaska Native">Native American or Alaska Native</option>
          <option value="Asian">Asian</option>
          <option value="Pacific Islander or Native Hawaiian">Pacific Islander or Native Hawaiian</option>
          <option value="Multiracial">Multiracial</option>
        </select>
        <label>Education Level (Optional)</label>
        <select name="education">
          <option value="" disabled selected hidden>Select your education</option>
          <option value="Less than high school">Less than high school</option>
          <option value="High school diploma or GED">High school diploma or GED</option>
          <option value="Some college">Some college</option>
          <option value="Associate's degree">Associate's degree</option>
          <option value="Bachelor's degree">Bachelor's degree</option>
          <option value="Graduate or professional degree">Graduate or professional degree</option>
        </select>
        <label>Relationship Status (Optional)</label>
        <select name="relationship">
          <option value="" disabled selected hidden>Select relationship status</option>
          <option value="Single">Single</option>
          <option value="In a relationship">In a relationship</option>
          <option value="Married">Married</option>
          <option value="Separated">Separated</option>
          <option value="Divorced">Divorced</option>
          <option value="Widowed">Widowed</option>
        </select>
        <label>Miscellaneous Comments (Optional)</label>
        <textarea 
          name="comments" 
          rows="4"
          placeholder="Any extra details...? (Optional)"></textarea>
        <label>Your Name (Optional)</label>
        <input type="text" name="name">
        <button type="submit" class="button">Submit</button>
      </form>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
    <div id="report-use-page" class="page">
      <h2>Report Narcan Use</h2>
      <form id="report-form">
        <input type="hidden" name="formType" value="use">
        <label>How many doses administered? *Two per box*</label>
        <input type="number" name="doses" min="1" required>
        <label>Result:</label><br>
        <label class="checkbox-label">
			    Overdose Reversal
			    <input
				    type="checkbox"
            name="result"
            value="Overdose Reversal"
				    id="reversal"
				    onclick="toggleExclusive('reversal')">
		    </label><br>
		    <label class="checkbox-label">
			    Overdose Death
			    <input
				    type="checkbox"
            name="result"
            value="Overdose Death"
				    id="death"
				    onclick="toggleExclusive('death')">
		    </label><br>
        <label>Was 911 called?</label>
        <select name="called911" required>
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <label>Did they go to the hospital?</label>
        <select name="hospital" required>
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Unknown">Unknown</option>
        </select>
        <label>Miscellaneous Comments (Optional)</label>
        <textarea 
          name="comments" 
          rows="4" 
          placeholder="Any extra details...? (Optional)"></textarea>
        <label>Your Name (Optional)</label>
        <input type="text" name="name" placeholder="e.g. John Doe">
        <button type="submit" class="button">Submit</button>
      </form>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
    <div id="contact-page" class="page">
      <h2>Contact ECLC</h2>
      <div class="map-container">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d253861.71266806905!2d-87.49288226143204!3d30.419463860282817!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8895c6f71e19b821%3A0xf36f913b34ce0255!2s518%20US%20Hwy%2090%2C%20Holt%2C%20FL%2032564!5e0!3m2!1sen!2sus!4v1686020473412!5m2!1sen!2sus"
          width="100%"
          height="250"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
      <p>
        <a
          href="https://www.google.com/maps/search/?api=1&query=518+US+Hwy+90+Holt+Florida+32564"
          target="_blank"
          rel="noopener"
        >518 US HWY 90, Holt, FL 32564</a>
      </p>
      <p><a href="tel:+18506125640" class="link-button">Call Us</a></p>
      <p><a href="mailto:emeraldcoastlifecenter@gmail.com" class="link-button">Email Us</a></p>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
    <div id="resources-page" class="page">
      <h2>Community Resources</h2>
      <ul class="resources">
        <li><a href="https://emeraldcoastlifecenter.org" target="_blank">Lighthouse @ Emerald Coast Life Center</a></li>
        <li><a href="https://havenhouserecovery.com" target="_blank">Haven House Recovery Home</a></li>
        <li><a href="https://pathofgrace.net" target="_blank">Path of Grace Recovery</a></li>
        <li><a href="https://988lifeline.org" target="_blank">24/7 Crisis Hotline</a></li>
      </ul>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
    <div id="impact-page" class="page">
      <h2>Community Impact</h2>
      <label for="impact-range">Select Range:</label><br>
      <select id="impact-range" onchange="updateImpact()">
        <option value="week">This Week</option>
        <option value="month" selected>This Month</option>
        <option value="year">This Year</option>
      </select>
      <div id="impact-stats"></div>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
    <div id="devotional-page" class="page">
      <h2>Recovery Devotional</h2>
      <div class="dev-nav">
        <button id="prev-day" aria-label="Previous Devotional">←</button>
        <span id="dev-date">Loading...</span>
        <button id="next-day" aria-label="Next Devotional">→</button>
      </div>
      <p id="devotional-verse">Loading verse...</p>
      <div id="devotional-text">Loading devotional...</div>
      <div class="back-button" onclick="showPage('home-page')">⬅️ Back to Home</div>
    </div>
  </main>
  <footer>Connect and Support!</footer>
    <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
        .catch(err => console.error('SW registration failed:', err));
      });
    }
    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');
    const isMobile = /Mobi|Android|iPhone|iPad|iPod|/i.test(navigator.userAgent);
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (isMobile) {
        installBtn.style.display = 'inline-block';
      }
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.disabled = true;
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      console.log('PWA install choice:', choice.outcome);
      deferredPrompt = null;
      installBtn.style.display = 'none'
    });
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxRVZcd0nZnjTBvwPTaHIsUck5wKHU8iEfmYaazWHIuqR0p8kLG6BrwqC-VCwNlHwRERg/exec'; 
    function handleImpact(data) {
      document.getElementById('impact-stats').innerHTML = `
        <p>Total Boxes Picked Up: ${data.pickedUp}</p>
        <p>Total Doses Used: ${data.dosesUsed}</p>
        <p>Lives Saved: ${data.livesSaved}</p>
        <p>Hospitalizations After Use: ${data.hospitalizations}</p>
      `;
    }
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(div => div.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }
    function pickupSuccess() {
      const name = document.querySelector('#pickup-form input[name="name"]').value;
      alert(name ? `Thank you, ${name}, for connecting and supporting your community!` :
                   'Thank you for connecting and supporting your community!');
      document.getElementById('pickup-form').reset();
      showPage('home-page');
    }
    function reportSuccess() {
      const name = document.querySelector('#report-form input[name="name"]').value;
      alert(name ? `Thank you, ${name}, for helping save lives!` :
                   'Thank you for helping save lives!');
      document.getElementById('report-form').reset();
      showPage('home-page');
    }
    function toggleExclusive(id) {
      ['reversal','death'].forEach(i => { if (i !== id) document.getElementById(i).checked = false; });
    }
    function updateImpact() {
      const range = document.getElementById('impact-range').value
      const s = document.createElement('script');
      s.src = `${GAS_URL}?action=impact&range=${range}&callback=handleImpact`;
      document.body.appendChild(s);
    };
function wire(formId, onSuccess) {
  const form = document.getElementById(formId);
  form.addEventListener('submit', e => {
    e.preventDefault();
    fetch(GAS_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: new FormData(form)
    })
    .then(() => onSuccess())
    .catch(err => {
      console.error(err);
      alert('Sorry, there was an error submitting the form');
    });
  });
}
document.addEventListener('DOMContentLoaded', () => {
  wire('pickup-form', pickupSuccess);
  wire('report-form', reportSuccess);
  updateImpact();  
});
let devosData = null;
let currentDate = new Date();
async function loadDevotional(d = new Date()) {
  try {
    if (!devosData) {
      const resp = await fetch('/devotions.json');
      devosData = await resp.json();
    }
    const key = `${d.getMonth()+1}-${d.getDate()}`;
    const today = devosData[key] || {
      verse: '"God is our refuge..." (Psalm 46:1)',
      text: "Unable to find today's devotional. Please check back later."
    };
    document.getElementById('devotional-verse').textContent = today.verse;
    const container = document.getElementById('devotional-text');
    container.innerHTML = '';
    today.text.split('\\n\\n').forEach(para => {
      const p = document.createElement('p');
      p.textContent = para;
      container.appendChild(p);
    });   
    document.getElementById('dev-date').textContent = 
      d.toLocaleDateString(undefined, {
        month: 'long', 
        day: 'numeric'
      });
  } catch (err) {
    console.error('Error loading devotional:', err);
    document.getElementById('dev-date').textContent = '';
    document.getElementById('devotional-verse').textContent =
      'Error loading devotional';
    document.getElementById('devotional-text').innerHTML = 
      "<p>Sorry, we couldn't load today's devotional. Please try again later.</p>";
  }
}
function shiftDay(offset) {
  currentDate.setDate(currentDate.getDate() + offset);
  loadDevotional(currentDate);
}
document.addEventListener('DOMContentLoaded', () => {
  loadDevotional(currentDate);
  document.getElementById('prev-day')
    .addEventListener('click', () => shiftDay(-1));
  document.getElementById('next-day')
    .addEventListener('click', () => shiftDay(1));
});
  </script>
</body>
</html>
